<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RedCrystal Studios | User Panel</title>

<style>
:root {
  --bg:#0b0810;
  --glass: rgba(255,255,255,0.06);
  --accent:#ff2d55;
  --accent-2:#7c5cff;
  --muted:#a7a0b2;
  --glass-border: rgba(255,255,255,0.04);
}
*{box-sizing:border-box;}
body{
  margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;
  background:var(--bg);color:#fff;
  -webkit-font-smoothing:antialiased;
  animation:fadeIn .8s ease;
}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

.sky{position:fixed;inset:0;z-index:-3;overflow:hidden;
  background:radial-gradient(ellipse at 10% 10%,rgba(255,45,85,0.06),transparent 6%),
             radial-gradient(ellipse at 90% 80%,rgba(124,92,255,0.04),transparent 10%),
             linear-gradient(180deg,rgba(8,6,14,1)0%,rgba(6,4,10,1)100%);
}
.glow-orb{position:absolute;width:600px;height:600px;left:10%;top:-10%;
  background:radial-gradient(circle at 30% 30%,rgba(255,45,85,0.12),transparent 20%),
             radial-gradient(circle at 70% 70%,rgba(124,92,255,0.08),transparent 30%);
  filter:blur(40px);z-index:-2;transform:rotate(10deg);
}

header{
  display:flex;align-items:center;justify-content:space-between;padding:20px 32px;position:relative;z-index:5;
}
.brand{display:flex;gap:14px;align-items:center;}
.brand h1{font-size:18px;margin:0;}
.brand p{margin:0;font-size:12px;color:var(--muted);}
nav{display:flex;gap:14px;align-items:center;}

.btn{
  padding:10px 16px;border-radius:10px;background:transparent;
  border:1px solid var(--glass-border);cursor:pointer;font-weight:600;
  color:white;transition:all 0.3s ease;
}
.btn:hover{background:rgba(255,255,255,0.05);}
.btn.primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  box-shadow:0 8px 30px rgba(124,92,255,0.14);color:white;border:0;
}
.btn.primary:hover{transform:scale(1.05);box-shadow:0 0 15px var(--accent);}

.panel{
  background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);
  border-radius:16px;box-shadow:0 0 20px rgba(255,0,50,0.3);
  padding:40px 50px;max-width:700px;margin:60px auto;text-align:center;
}
input,textarea{
  padding:10px;border:none;border-radius:8px;margin:6px 0;width:100%;
  background:rgba(255,255,255,0.1);color:#fff;
}
.chat-box{
  max-height:400px;overflow-y:auto;text-align:left;padding:10px;
  background:rgba(255,255,255,0.03);border-radius:8px;margin-top:10px;
}
.message{margin:8px 0;padding:8px;border-radius:8px;background:rgba(255,255,255,0.05);}
.message strong{color:#ff2d55;}
footer{padding:22px 8vw;color:var(--muted);font-size:14px;text-align:center;border-top:1px solid var(--glass-border);}
</style>
</head>

<body>
<div class="sky"><div class="glow-orb"></div></div>

<header>
  <div class="brand">
    <img src="img/RCS LOG.png" alt="RedCrystal Studios Logo" width="160">
    <div>
      <h1>RedCrystal_Studios</h1>
      <p>Indie studio — games & websites</p>
    </div>
  </div>
  <nav>
    <a href="workg.html" class="btn">Projects</a>
    <a href="contactg.html" class="btn">Contact/Socials</a>
    <a href="index.html" class="btn primary">Back Home</a>
  </nav>
</header>

<section class="panel" id="authSection">
  <h2>Login or Sign Up</h2>
  <input type="email" id="emailInput" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <div style="margin-top:12px;">
    <button id="loginBtn" class="btn primary">Login</button>
    <button id="signupBtn" class="btn">Sign Up</button>
  </div>
  <p id="authMsg"></p>
</section>

<section class="panel" id="chatSection" style="display:none;">
  <h2>Welcome, <span id="usernameDisplay"></span>!</h2>
  <input type="text" id="displayName" placeholder="Choose a display name..." />
  <button id="saveNameBtn" class="btn primary">Save Name</button>

  <div class="chat-box" id="chatBox"></div>

  <textarea id="chatInput" rows="2" placeholder="Type your message..."></textarea>
  <button id="sendMsgBtn" class="btn primary">Send Message</button>
</section>

<footer>
  <p>© 2025 RedCrystal_Studios — All rights reserved.</p>
</footer>

<!-- Firebase + Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCK6PEV_f87dGuU8k04rSmL7wRVxzIynkQ",
  authDomain: "alvion-chronicles.firebaseapp.com",
  projectId: "alvion-chronicles",
  storageBucket: "alvion-chronicles.firebasestorage.app",
  messagingSenderId: "943295347187",
  appId: "1:943295347187:web:6e09f5a56576326df07a86",
  measurementId: "G-E092NF3R9V"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const authSection = document.getElementById('authSection');
const chatSection = document.getElementById('chatSection');
const authMsg = document.getElementById('authMsg');
const chatBox = document.getElementById('chatBox');
const usernameDisplay = document.getElementById('usernameDisplay');

// Login / Signup
document.getElementById('loginBtn').onclick = async () => {
  const email = emailInput.value.trim();
  const pass = password.value.trim();
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    loadChat();
  } catch (e) {
    authMsg.textContent = "⚠️ " + e.message;
  }
};

document.getElementById('signupBtn').onclick = async () => {
  const email = emailInput.value.trim();
  const pass = password.value.trim();
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email, pass);
    await set(ref(db, 'users/' + userCred.user.uid), {
      email: email,
      displayName: "New User"
    });
    loadChat();
  } catch (e) {
    authMsg.textContent = "⚠️ " + e.message;
  }
};

// Load chat + user info
function loadChat() {
  authSection.style.display = "none";
  chatSection.style.display = "block";
  const uid = auth.currentUser.uid;
  const userRef = ref(db, "users/" + uid);
  onValue(userRef, snap => {
    const data = snap.val();
    const name = data?.displayName || localStorage.getItem("displayName") || "User";
    usernameDisplay.textContent = name;
    localStorage.setItem("displayName", name);
  });

  const msgRef = ref(db, "messages");
  onValue(msgRef, snap => {
    const data = snap.val();
    chatBox.innerHTML = data
      ? Object.values(data).map(m => `
          <div class="message"><strong>${m.displayName || "Anonymous"}:</strong> ${m.text}</div>
        `).join("")
      : "<p style='color:#888;'>No messages yet.</p>";
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

// Save display name (and remember it)
document.getElementById('saveNameBtn').onclick = async () => {
  const name = displayName.value.trim();
  if (!name) return alert("Enter a name first!");
  const uid = auth.currentUser.uid;
  await set(ref(db, "users/" + uid + "/displayName"), name);
  localStorage.setItem("displayName", name);
  usernameDisplay.textContent = name;
  alert("✅ Name saved!");
};

// Send message
document.getElementById('sendMsgBtn').onclick = async () => {
  const text = chatInput.value.trim();
  if (!text) return;
  const uid = auth.currentUser.uid;
  const name = localStorage.getItem("displayName") || usernameDisplay.textContent || "Anonymous";
  await push(ref(db, "messages"), {
    uid,
    text,
    displayName: name,
    time: serverTimestamp()
  });
  chatInput.value = "";
};
</script>
</body>
</html>
